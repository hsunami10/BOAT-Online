<!DOCTYPE html>
<html>
<head>
	<title>BOAT Online</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  	<script src="/socket.io/socket.io.js"></script>
  	<link rel="stylesheet" type="text/css" href="startmenu.css">
</head>
<body>

	<form id="signInDiv">
		<h1>BOAT Online</h1>
		<label id="username-label">Username</label><br>
		<input type="text" id="signInDiv-username" placeholder="Username"></input><br>
		<label id="password-label">Password</label><br>
		<input type="password" id="signInDiv-password" placeholder="Password"></input><br>
		<p>Don't have an account? Sign up <a href="signup.html">here</a>.</p>
		<p id="alert"></p>
		<button type="submit">Log In</button><br>
	</form>

	<div id="gameDiv" style="display: none;">
		<canvas id="ctx" style="border: 1px solid black;"></canvas>
	</div>

	<script>
		// Initialize socket
		var socket = io('/game');
		var ctx = document.getElementById('ctx').getContext('2d');

		// Get screen resolution
		var screenWidth = $(window).width();
		var screenHeight = $(window).height();


		// Sign in
		$('#signInDiv').submit(function(e) {
			e.preventDefault();

			socket.emit('sign-in', {username: $('#signInDiv-username').val(), password: $('#signInDiv-password').val()});
		});
		socket.on('sign-in-response', function(data) {
			if(data.success) {
				$('#signInDiv').hide();
				$('#gameDiv').show();
			}
			else
				$('#alert').text('Invalid username/password');
		});


		// Also, when the page is reloaded on while on the gameDiv, the sign in screen is shown but ball is still visible
		// ***************Scale position of elements to be the same throughout every screen resolution*************

		// Canvas properties
		ctx.canvas.width = screenWidth;
		ctx.canvas.height = screenHeight;

		socket.on('positionChange', function(data) {
			ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

			for(var i = 0; i < data.ball.length; i++) {
				// Draw circle
				ctx.beginPath();
				ctx.arc(data.ball[i].x, data.ball[i].y, 30, 0, 2 * Math.PI);
				ctx.fillStyle = 'green';
				ctx.fill();
				ctx.stroke();
			}
		});

		// Key handling
		$(document).keydown(function(event) {
			if(event.keyCode == 68) //d
				socket.emit('keyPress', {inputId: 'right', state: true});
			else if(event.keyCode === 83) //s
				socket.emit('keyPress', {inputId: 'down', state: true});
			else if(event.keyCode === 65) //a
				socket.emit('keyPress', {inputId: 'left', state: true});
			else if(event.keyCode === 87) //w
				socket.emit('keyPress', {inputId: 'up', state: true});
		});

		$(document).keyup(function(event) {
			if(event.keyCode === 68) //d
				socket.emit('keyPress', {inputId: 'right', state: false});
			else if(event.keyCode === 83) //s
				socket.emit('keyPress', {inputId: 'down', state: false});
			else if(event.keyCode === 65) //a
				socket.emit('keyPress', {inputId: 'left', state: false});
			else if(event.keyCode === 87) //w
				socket.emit('keyPress', {inputId: 'up', state: false});
		});
	</script>

</body>
</html>